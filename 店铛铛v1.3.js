/**
 * 注册链接: https://mallapps.jiudageapp.com/#/pages/subject/newcomerDebut?id=0&platform=web&shardCode=Xhdw3kU1d&unlockStatus=0&showNewbiePoster=1&level=2 
 * 
 * 【环境变量配置】
 * 1. DDD_ACCOUNTS（必需）- 账号密码配置，多账号用换行分隔
 *    格式：手机号&密码
 *    示例：
 *    18665189270&13579Abc
 *    13800138000&password123
 * 
 * 2. 青龙面板token持久化配置（推荐配置，支持自动缓存token）
 *    QL_CLIENT_ID - 青龙面板》》系统设置》》应用设置》》Client ID
 *    QL_CLIENT_SECRET - 青龙面板》》系统设置》》应用设置》》Client Secret  
 *    QL_API_URL - 青龙面板地址（固定勿修改：http://localhost:5700）
 * 
 * 【工作原理】
 * - 首次运行：使用账号密码登录获取token → 自动保存到青龙面板DDD变量
 * - 后续运行：先验证青龙缓存的token → 有效则直接使用 → 过期则重新登录
 */

// 【免责声明】
// 脚本仅供学习交流，禁止用于商业用途和非法行为
// 请遵守目标平台服务条款及国家法律法规，使用风险自负
// ============================================================================

// ===================== 青龙面板配置 =====================
const QL_CONFIG = {
  CLIENT_ID: process.env.QL_CLIENT_ID || '9bVZa-JnTm-w',
  CLIENT_SECRET: process.env.QL_CLIENT_SECRET || 'i6miR_cusVftsrkmS50cMY3c',
  API_URL: process.env.QL_API_URL || 'http://127.0.0.1:5700',  // 容器内部端口
  ENV_NAME: 'DDD'  // 存储token的环境变量名称
};

// ===================== 核心参数配置（前置便于修改）=====================
const TASK_CONFIG = {
  COUNTDOWN_REFRESH_INTERVAL: 1000,  // 倒计时刷新频率（毫秒）
  WATCH_DURATION_MODE: "fixed",       // 观看时长模式（fixed=固定，auto=适配）
  FIXED_WATCH_SEC: 30,              // 固定观看秒数（fixed模式用）
  INTERVAL_SEC: 5,                   // 广告间间隔秒数
  RETRY_COUNT: 3,                    // 接口重试次数
  TIMEOUT: 30000,                    // 请求超时时间（30秒）
  RANDOM_MIN_MINUTES: 1,             // 最小随机分钟数
  RANDOM_MAX_MINUTES: 3,             // 最大随机分钟数
  PROFIT_WAIT_SEC: 4,                // 收益同步等待时间
  MAX_RECEIVE_ERRORS: 2              // 最大领取奖励错误次数（超过此次数则跳到下个号）
};

// 核心参数写死，不允许外部修改
const REQUIRED_INVITE_ID = 10639;      // 需校验的上级ID【写死核心配置】
const API_HOST = "gw.jiudageapp.com"; // 接口域名【写死核心配置】
const VERIFY_INVITE_ID = false; // 是否校验上级邀请码（true=校验，false=跳过） 















const _0x266875 = _0x33bd; (function (_0x4343fe, _0x17c104) { const _0x567d95 = _0x33bd, _0x33a2c8 = _0x4343fe(); while (!![]) { try { const _0x4c4fc6 = parseInt(_0x567d95(0x11f)) / 0x1 * (parseInt(_0x567d95(0x12a)) / 0x2) + -parseInt(_0x567d95(0x127)) / 0x3 + parseInt(_0x567d95(0x17d)) / 0x4 + parseInt(_0x567d95(0x133)) / 0x5 + -parseInt(_0x567d95(0x16f)) / 0x6 + -parseInt(_0x567d95(0xdd)) / 0x7 + parseInt(_0x567d95(0x129)) / 0x8 * (-parseInt(_0x567d95(0xd9)) / 0x9); if (_0x4c4fc6 === _0x17c104) break; else _0x33a2c8['push'](_0x33a2c8['shift']()); } catch (_0x1857a8) { _0x33a2c8['push'](_0x33a2c8['shift']()); } } }(_0x5e6e, 0x98019)); const axios = require(_0x266875(0xdf)), CryptoJS = require(_0x266875(0x142)); function log(_0x5e4981, _0x1e60e7 = !![]) { const _0x55acbd = _0x266875, _0x28c5e2 = _0x1e60e7 ? '' : '❌\x20'; console[_0x55acbd(0x138)]('[' + new Date()[_0x55acbd(0x173)]() + ']\x20' + _0x28c5e2 + _0x5e4981); } function wait(_0x11cc02) { return new Promise(_0x26e892 => setTimeout(_0x26e892, _0x11cc02 * 0x3e8)); } function getRandomWaitSeconds() { const _0x9177e9 = _0x266875, _0x120dd1 = Math[_0x9177e9(0xe6)](Math[_0x9177e9(0x163)]() * (TASK_CONFIG[_0x9177e9(0x108)] - TASK_CONFIG[_0x9177e9(0x179)] + 0x1)) + TASK_CONFIG['RANDOM_MIN_MINUTES'], _0xcbadf9 = _0x120dd1 * 0x3c; return log(_0x9177e9(0x146) + _0x120dd1 + _0x9177e9(0x148) + _0xcbadf9 + '秒）'), _0xcbadf9; } function parsePlatformFromUA(_0x4e8301) { const _0x56ea04 = _0x266875; if (!_0x4e8301) return 'Android'; if (_0x4e8301[_0x56ea04(0xe2)]('iOS') || _0x4e8301[_0x56ea04(0xe2)](_0x56ea04(0xea))) return _0x56ea04(0x137); else return _0x4e8301[_0x56ea04(0xe2)](_0x56ea04(0x119)) || _0x4e8301[_0x56ea04(0xe2)]('com.jiudageapp.android') ? _0x56ea04(0x119) : 'Android'; } function parseVersionFromUA(_0x100046) { const _0x3ab067 = _0x266875; if (!_0x100046) return 'v1.6.1'; const _0x9936ec = _0x100046[_0x3ab067(0x174)](/GZHealth\/([\d.]+)/); return _0x9936ec ? 'v' + _0x9936ec[0x1] : _0x3ab067(0x162); } function calcVideoDuration(_0x389b39) { const _0x143a2e = _0x266875, _0x525c58 = _0x389b39 / 0x400 / 0x400; return Math[_0x143a2e(0x143)](Math['floor'](_0x525c58 * 0x8), 0xa); } function _0x33bd(_0x4bdaa0, _0x5bb3bb) { _0x4bdaa0 = _0x4bdaa0 - 0xd6; const _0x5e6ee4 = _0x5e6e(); let _0x33bd79 = _0x5e6ee4[_0x4bdaa0]; return _0x33bd79; } function desEncrypt(_0x8f633a, _0xc2c5fa) { const _0x419d0c = _0x266875, _0x233b62 = CryptoJS[_0x419d0c(0xe8)][_0x419d0c(0x14b)][_0x419d0c(0xe5)](_0xc2c5fa), _0xa0e1dd = CryptoJS[_0x419d0c(0xe8)][_0x419d0c(0x14b)][_0x419d0c(0xe5)](_0x8f633a), _0x109664 = CryptoJS['DES']['encrypt'](_0xa0e1dd, _0x233b62, { 'mode': CryptoJS[_0x419d0c(0x15e)][_0x419d0c(0x181)], 'padding': CryptoJS[_0x419d0c(0x175)][_0x419d0c(0x12b)] }); return _0x109664[_0x419d0c(0x105)](); } function md5Encrypt(_0x2006ec) { const _0x3dad16 = _0x266875; return CryptoJS['MD5'](_0x2006ec)[_0x3dad16(0x105)]()[_0x3dad16(0x140)](); } async function getQingLongToken() { const _0x223ab4 = _0x266875; if (!QL_CONFIG[_0x223ab4(0x120)] || !QL_CONFIG[_0x223ab4(0xee)]) return log(_0x223ab4(0x123)), null; try { const _0x3437b4 = await axios({ 'method': _0x223ab4(0x13c), 'url': QL_CONFIG['API_URL'] + '/open/auth/token', 'params': { 'client_id': QL_CONFIG[_0x223ab4(0x120)], 'client_secret': QL_CONFIG[_0x223ab4(0xee)] }, 'timeout': 0x2710 }); return _0x3437b4[_0x223ab4(0x13d)] && _0x3437b4['data'][_0x223ab4(0x11c)] === 0xc8 ? (log('青龙面板认证成功'), _0x3437b4[_0x223ab4(0x13d)][_0x223ab4(0x13d)][_0x223ab4(0x100)]) : (log('青龙面板认证失败：' + JSON[_0x223ab4(0x16b)](_0x3437b4[_0x223ab4(0x13d)]), ![]), null); } catch (_0x2d2cdc) { return log('青龙面板认证异常：' + _0x2d2cdc['message'], ![]), null; } } async function getEnvFromQingLong(_0x10ca11, _0x1201eb) { const _0x21c243 = _0x266875; try { const _0x14e47 = await axios({ 'method': _0x21c243(0x13c), 'url': QL_CONFIG[_0x21c243(0xfb)] + _0x21c243(0x116), 'headers': { 'Authorization': _0x21c243(0x15a) + _0x10ca11 }, 'params': { 'searchValue': _0x1201eb }, 'timeout': 0x2710 }); if (_0x14e47[_0x21c243(0x13d)] && _0x14e47[_0x21c243(0x13d)][_0x21c243(0x11c)] === 0xc8) { const _0x50472c = _0x14e47['data']['data'], _0x1dda3b = _0x50472c[_0x21c243(0x164)](_0x5c5dc4 => _0x5c5dc4[_0x21c243(0x12e)] === _0x1201eb); return _0x1dda3b || null; } return null; } catch (_0x37bcfc) { return log('获取青龙环境变量失败：' + _0x37bcfc[_0x21c243(0x14c)], ![]), null; } } async function updateEnvToQingLong(_0x4016a7, _0x27a054, _0x518c21, _0x1202f2 = null) { const _0x18efd0 = _0x266875; try { let _0x51b488; return _0x1202f2 ? _0x51b488 = await axios({ 'method': _0x18efd0(0xde), 'url': QL_CONFIG[_0x18efd0(0xfb)] + _0x18efd0(0x116), 'headers': { 'Authorization': _0x18efd0(0x15a) + _0x4016a7, 'Content-Type': _0x18efd0(0x12c) }, 'data': { 'id': _0x1202f2, 'name': _0x27a054, 'value': _0x518c21 }, 'timeout': 0x2710 }) : _0x51b488 = await axios({ 'method': _0x18efd0(0xfe), 'url': QL_CONFIG[_0x18efd0(0xfb)] + _0x18efd0(0x116), 'headers': { 'Authorization': _0x18efd0(0x15a) + _0x4016a7, 'Content-Type': _0x18efd0(0x12c) }, 'data': [{ 'name': _0x27a054, 'value': _0x518c21 }], 'timeout': 0x2710 }), _0x51b488[_0x18efd0(0x13d)] && _0x51b488[_0x18efd0(0x13d)]['code'] === 0xc8 ? (log(_0x18efd0(0xf5) + (_0x1202f2 ? '更新' : '创建') + _0x18efd0(0x130) + _0x27a054), !![]) : (log(_0x18efd0(0xf5) + (_0x1202f2 ? '更新' : '创建') + _0x18efd0(0x131) + JSON[_0x18efd0(0x16b)](_0x51b488['data']), ![]), ![]); } catch (_0x2c3100) { return log('青龙环境变量操作异常：' + _0x2c3100[_0x18efd0(0x14c)], ![]), ![]; } } async function loginWithPassword(_0x2fc9cc, _0x30c6be) { const _0x1858af = _0x266875; try { const _0x2efd37 = md5Encrypt(_0x30c6be), _0x420f0e = await axios({ 'method': _0x1858af(0xfe), 'url': _0x1858af(0x125) + API_HOST + '/api/web/auth/pwdLogin', 'headers': { 'User-Agent': _0x1858af(0xe1), 'Accept-Encoding': 'gzip', 'Content-Type': _0x1858af(0x12c), 'version': _0x1858af(0x162), 'platform': _0x1858af(0x119) }, 'data': { 'password': _0x2efd37, 'phone': _0x2fc9cc }, 'timeout': TASK_CONFIG[_0x1858af(0xdb)] }), _0x29810c = _0x420f0e['data']; if (_0x29810c['code'] !== 0xc8) return log('账号' + _0x2fc9cc + _0x1858af(0x17b) + (_0x29810c[_0x1858af(0x14c)] || JSON[_0x1858af(0x16b)](_0x29810c)), ![]), null; const _0x536ee4 = _0x29810c[_0x1858af(0x11a)], _0x2e7995 = _0x536ee4['token'], _0x2c65dc = _0x536ee4['nickName'] || '未知', _0x1ae23f = await getAppVersion('Android'), _0xd310e0 = _0x1ae23f ? _0x1ae23f['version_no_show'] : '1.6.1', _0x46307d = _0x1ae23f ? versionToBuild(_0xd310e0) : 0xa1, _0x277afa = _0x1858af(0x182) + _0xd310e0 + _0x1858af(0x157) + _0x46307d + _0x1858af(0x110); return log(_0x1858af(0x13b) + _0x2fc9cc + '登录成功，昵称：' + _0x2c65dc), { 'token': _0x2e7995, 'ua': _0x277afa, 'nickName': _0x2c65dc, 'phone': _0x2fc9cc }; } catch (_0x22b7e9) { return log('账号' + _0x2fc9cc + _0x1858af(0x14d) + _0x22b7e9[_0x1858af(0x14c)], ![]), null; } } async function getAppVersion(_0x5cef76) { const _0x2ffa95 = _0x266875; try { const _0x5d66d2 = await axios({ 'method': _0x2ffa95(0xfe), 'url': _0x2ffa95(0x125) + API_HOST + _0x2ffa95(0x10d), 'headers': { 'User-Agent': 'okhttp/4.10.0', 'Content-Type': _0x2ffa95(0x12c) }, 'data': { 'deviceType': _0x5cef76 === _0x2ffa95(0x137) ? _0x2ffa95(0xf8) : _0x5cef76 }, 'timeout': 0x2710 }), _0x30359f = _0x5d66d2[_0x2ffa95(0x13d)]; if (_0x30359f[_0x2ffa95(0x11c)] === 0xc8 && _0x30359f[_0x2ffa95(0x11a)]) return { 'version_no_show': _0x30359f[_0x2ffa95(0x11a)][_0x2ffa95(0xef)] || '1.6.1', 'version_num': _0x30359f[_0x2ffa95(0x11a)][_0x2ffa95(0x155)] || 0x0 }; return null; } catch (_0x14247d) { return log('获取版本信息失败：' + _0x14247d[_0x2ffa95(0x14c)], ![]), null; } } function versionToBuild(_0x4143c5) { const _0x164e65 = _0x266875; return parseInt(_0x4143c5[_0x164e65(0x160)](/\./g, '')); } async function isTokenValid(_0x925f16, _0x458f88, _0x51d8ee, _0x4dc2cb) { const _0x1d7019 = _0x266875; try { const _0x4c2130 = await requestWithRetry({ 'method': _0x1d7019(0xfe), 'url': _0x1d7019(0x125) + API_HOST + _0x1d7019(0x107), 'headers': { 'authorization': _0x925f16, 'version': _0x4dc2cb, 'accept-encoding': _0x1d7019(0x11b), 'user-agent': _0x458f88, 'content-length': '0' } }, _0x51d8ee); return _0x4c2130['success'] === !![]; } catch (_0x43c697) { return ![]; } } async function requestWithRetry(_0x3748ed, _0x1fe423, _0x41d2c5 = TASK_CONFIG[_0x266875(0x11d)]) { const _0x39eb73 = _0x266875; try { const _0x1a1e16 = { ..._0x3748ed, 'timeout': TASK_CONFIG['TIMEOUT'], 'headers': { ..._0x3748ed['headers'], 'platform': _0x1fe423 } }, _0x4884ef = await axios(_0x1a1e16); return _0x4884ef['data']; } catch (_0x34923f) { if (_0x41d2c5 > 0x0) return log(_0x39eb73(0x124) + _0x41d2c5 + _0x39eb73(0xe4) + _0x34923f[_0x39eb73(0x14c)]), await wait(0x2), requestWithRetry(_0x3748ed, _0x1fe423, _0x41d2c5 - 0x1); throw _0x34923f; } } async function getMemberCenterInfo(_0x350bdb, _0x5baedf, _0x2d54b2, _0x58261b) { const _0x289fb2 = _0x266875; try { const _0x2f14b2 = await requestWithRetry({ 'method': 'POST', 'url': _0x289fb2(0x125) + API_HOST + _0x289fb2(0x144), 'headers': { 'authorization': _0x350bdb, 'version': _0x58261b, 'content-length': '0', 'accept-encoding': _0x289fb2(0x11b), 'user-agent': _0x5baedf } }, _0x2d54b2); if (_0x2f14b2[_0x289fb2(0x12f)] && _0x2f14b2[_0x289fb2(0x11a)]) { const _0x2d6e8c = { 'watched': _0x2f14b2[_0x289fb2(0x11a)][_0x289fb2(0x13f)], 'total': _0x2f14b2[_0x289fb2(0x11a)][_0x289fb2(0xf2)], 'remaining': _0x2f14b2[_0x289fb2(0x11a)][_0x289fb2(0xf2)] - _0x2f14b2[_0x289fb2(0x11a)][_0x289fb2(0x13f)], 'contribution': _0x2f14b2[_0x289fb2(0x11a)][_0x289fb2(0xf6)], 'canWithdraw': _0x2f14b2[_0x289fb2(0x11a)][_0x289fb2(0x16e)], 'inviteCode': _0x2f14b2[_0x289fb2(0x11a)][_0x289fb2(0x14a)] }; return log(_0x289fb2(0x165) + _0x2d6e8c['watched'] + '/' + _0x2d6e8c[_0x289fb2(0x115)] + _0x289fb2(0x126) + _0x2d6e8c[_0x289fb2(0xd6)] + '次'), log(_0x289fb2(0x166) + _0x2d6e8c['contribution'] + _0x289fb2(0xf1) + (_0x2d6e8c[_0x289fb2(0x111)] ? '是' : '否')), log(_0x289fb2(0x186) + _0x2d6e8c[_0x289fb2(0x14a)]), _0x2d6e8c; } else return log(_0x289fb2(0x106) + _0x2f14b2[_0x289fb2(0x14c)]), null; } catch (_0x163cb5) { return log(_0x289fb2(0xda) + _0x163cb5['message']), null; } } async function checkMiniAppBound(_0x1fc959, _0x407faf, _0x2156f2, _0x353643) { const _0x5e392a = _0x266875; try { const _0x495d2b = await requestWithRetry({ 'method': _0x5e392a(0x13c), 'url': 'https://' + API_HOST + '/api/web/member/hasMiniAppBoundToday', 'headers': { 'authorization': _0x1fc959, 'version': _0x353643, 'accept-encoding': _0x5e392a(0x11b), 'user-agent': _0x407faf } }, _0x2156f2); return _0x495d2b['success'] ? (log(_0x5e392a(0x147) + (_0x495d2b[_0x5e392a(0x11a)] ? '已绑定' : _0x5e392a(0x176))), _0x495d2b[_0x5e392a(0x11a)]) : (log('获取小程序绑定状态失败：' + _0x495d2b[_0x5e392a(0x14c)]), ![]); } catch (_0x5e335c) { return log(_0x5e392a(0xf3) + _0x5e335c[_0x5e392a(0x14c)]), ![]; } } async function getInternalAdVideoId(_0x278587, _0x58dd1b, _0x1fd84e, _0x2d21ac) { const _0x49e6fe = _0x266875; try { const _0x2bb65b = await requestWithRetry({ 'method': 'POST', 'url': _0x49e6fe(0x125) + API_HOST + _0x49e6fe(0x154), 'headers': { 'authorization': _0x278587, 'version': _0x2d21ac, 'content-length': '0', 'accept-encoding': 'gzip', 'user-agent': _0x58dd1b } }, _0x1fd84e); if (_0x2bb65b[_0x49e6fe(0x12f)] && _0x2bb65b[_0x49e6fe(0x11a)]?.['id']) { const _0x55dc40 = _0x2bb65b[_0x49e6fe(0x11a)]['id'], _0x352dea = _0x2bb65b[_0x49e6fe(0x11a)][_0x49e6fe(0x14f)]; return log('动态获取广告视频ID成功：' + _0x55dc40 + '，视频地址：' + _0x352dea), _0x55dc40; } else return log(_0x49e6fe(0x158) + (_0x2bb65b[_0x49e6fe(0x14c)] || '无视频ID返回')), null; } catch (_0x5d9dad) { return log(_0x49e6fe(0x11e) + _0x5d9dad['message']), null; } } function _0x5e6e() { const _0x365ed2 = ['/api/web/setting/getLastVersionInfo', '脚本执行异常：', '✅\x20Token已成功同步到青龙面板！', ';\x20Android\x2013.1.0)\x20okhttp/4.10.0', 'canWithdraw', 'substring', '现有环境变量：', '等待\x20', 'total', '/open/envs', '⚠️\x20未配置青龙面板Client\x20ID/Secret，token将不会持久化', 'WATCH_DURATION_MODE', 'Android', 'result', 'gzip', 'code', 'RETRY_COUNT', '广告信息接口异常：', '1077551BowEda', 'CLIENT_ID', '账号格式错误，需为\x20token#ua\x20格式', 'QQ交流群：1002163255', '未配置青龙面板Client\x20ID/Secret，跳过token持久化', '请求失败，剩余重试次数：', 'https://', '次，剩余', '2061828zqumgg', ',\x20accounts=', '56PkycMQ', '2lmeBxY', 'Pkcs7', 'application/json', 'min', 'name', 'success', '成功：', '失败：', '，兑换值：', '5898000XfkpYx', '请在青龙面板添加环境变量：', '不存在', '个账号登录失败，跳过', 'iOS', 'log', '示例：18665189270&13579Abc', 'forEach', '✅\x20账号', 'GET', 'data', '没有可用的账号，脚本终止', 'watchedVideoCount', 'toUpperCase', '会员信息接口异常：', 'crypto-js', 'max', '/api/web/member/getMemberCenterInfo', '\x0a=======\x20所有账号任务执行完毕\x20=======', '生成随机等待时间：', '今日小程序绑定状态：', '分钟（', 'totalVideoCount', 'inviteCode', 'Utf8', 'message', '登录异常：', '将要同步的token数据（', 'videoUrl', 'inviteMemberId', '今日累计观看：', '\x0a==========\x20开始执行账号任务\x20[', '领取奖励错误次数已达', '/api/web/member/get/internalAdvertisement', 'versionNum', 'ENV_NAME', '\x20(com.jiudageapp.android;\x20build:', '获取广告信息失败：', '\x20->\x20URL编码：', 'Bearer\x20', 'env', '变量值：手机号&密码（多账号用换行分隔）', 'push', 'mode', '存在(ID=', 'replace', 'MAX_RECEIVE_ERRORS', 'v1.6.1', 'random', 'find', '今日广告任务进度：已看', '当前累计贡献值：', 'filter', '正在登录第', '开始观看广告，视频ID：', 'actualReceiveRedemptionValue', 'stringify', '==========\x20账号任务执行结束\x20==========\x0a', 'phone', 'canNewMemberWithdrawal', '881892jvaUVl', '准备同步token到青龙面板：qlToken=', 'trim', '获取视频ID失败，跳过本次循环', 'toLocaleString', 'match', 'pad', '未绑定', '自动估算观看时长：', '视频ID加密结果：', 'RANDOM_MIN_MINUTES', 'value', '登录失败：', '视频ID为空，无法执行广告任务', '4839416IZYnSz', 'DDD_ACCOUNTS', '\x20\x20账号', '次，终止当前账号任务', 'ECB', 'GZHealth/', '次错误），跳过本次循环', '固定观看时长：', '\x20个账号配置', '用户邀请码：', 'remaining', '成功获取\x20', '次，超过最大限制', '2328039vzeNbU', '会员中心接口异常：', 'TIMEOUT', '无法获取邀请码，终止任务', '1396031QPxvml', 'PUT', 'axios', '个账号的缓存token仍然有效', 'okhttp/4.10.0', 'includes', '...', '，错误信息：', 'parse', 'floor', 'length', 'enc', '个账号的缓存token已过期，将重新登录', 'com.jiudageapp.ios', '/api/web/newPeopleUnlock/receiveWelfareNineteenV2?videoId=', '\x20秒后执行下一个账号...', '行）：', 'CLIENT_SECRET', 'versionNoShow', 'actualReceiveContribution', '，是否可提现：', 'videoCount', '小程序绑定状态校验接口异常：', '检测到青龙面板配置，启用token持久化功能', '青龙环境变量', 'contribution', '今日广告任务已全部完成，无剩余次数', 'Ios', '个账号：', '本次广告任务执行失败（第', 'API_URL', '⚠️\x20未获取到青龙面板token，跳过同步', ']\x20==========', 'POST', '❌\x20未配置环境变量\x20DDD_ACCOUNTS！', 'token', 'join', 'ℹ️\x20所有token均来自缓存且有效，无需更新青龙面板', '广告福利领取成功！贡献值：', ',\x20needUpdateQL=', 'toString', '获取会员中心信息失败：', '/api/web/member/getMemberInfo', 'RANDOM_MAX_MINUTES', 'split', 'fixed', '共读取到\x20', '获取会员信息失败：']; _0x5e6e = function () { return _0x365ed2; }; return _0x5e6e(); } async function getMemberInfo(_0x9ca5, _0x32091d, _0x5b26c2, _0x52a702) { const _0x56e1b7 = _0x266875; try { const _0x130ff7 = await requestWithRetry({ 'method': _0x56e1b7(0xfe), 'url': _0x56e1b7(0x125) + API_HOST + _0x56e1b7(0x107), 'headers': { 'authorization': _0x9ca5, 'version': _0x52a702, 'accept-encoding': _0x56e1b7(0x11b), 'user-agent': _0x32091d, 'content-length': '0' } }, _0x5b26c2); if (_0x130ff7[_0x56e1b7(0x12f)]) { const _0x59ce81 = _0x130ff7[_0x56e1b7(0x11a)][_0x56e1b7(0x150)] === REQUIRED_INVITE_ID, _0x3b05a4 = _0x130ff7[_0x56e1b7(0x11a)][_0x56e1b7(0x16d)] || '未知', _0x427535 = _0x130ff7[_0x56e1b7(0x11a)]['id'], _0x449f12 = _0x130ff7[_0x56e1b7(0x11a)][_0x56e1b7(0x150)]; return { 'success': _0x59ce81, 'phone': _0x3b05a4 }; } else return log(_0x56e1b7(0x10c) + _0x130ff7['message'], ![]), { 'success': ![], 'phone': null }; } catch (_0x10d660) { return log(_0x56e1b7(0x141) + _0x10d660[_0x56e1b7(0x14c)], ![]), { 'success': ![], 'phone': null }; } } async function watchAdAndReceiveWelfare(_0x5a5cde, _0xf191fb, _0x34ed83, _0xba641a, _0x2148bc, _0x90784f) { const _0x3b846 = _0x266875; if (!_0xba641a) return log(_0x3b846(0x17c), ![]), ![]; try { let _0x287e45 = 0x0; TASK_CONFIG[_0x3b846(0x118)] === _0x3b846(0x10a) ? (_0x287e45 = TASK_CONFIG['FIXED_WATCH_SEC'], log(_0x3b846(0x184) + _0x287e45 + '秒')) : (_0x287e45 = calcVideoDuration(0x5 * 0x400 * 0x400), log(_0x3b846(0x177) + _0x287e45 + '秒')); log(_0x3b846(0x169) + _0xba641a), await wait(_0x287e45), await wait(TASK_CONFIG['INTERVAL_SEC']); const _0x3ac165 = desEncrypt(String(_0xba641a), _0x90784f), _0x4cb65e = encodeURIComponent(_0x3ac165); log(_0x3b846(0x178) + _0x3ac165 + _0x3b846(0x159) + _0x4cb65e); const _0x2b802e = await requestWithRetry({ 'method': 'POST', 'url': 'https://' + API_HOST + _0x3b846(0xeb) + _0x4cb65e, 'headers': { 'authorization': _0x5a5cde, 'version': _0x2148bc, 'accept-encoding': _0x3b846(0x11b), 'user-agent': _0xf191fb, 'content-length': '0' } }, _0x34ed83); return _0x2b802e[_0x3b846(0x12f)] ? (log(_0x3b846(0x103) + _0x2b802e[_0x3b846(0x11a)][_0x3b846(0xf0)] + _0x3b846(0x132) + _0x2b802e[_0x3b846(0x11a)][_0x3b846(0x16a)]), log(_0x3b846(0x151) + _0x2b802e[_0x3b846(0x11a)]['visitedVideoCount'] + '/' + _0x2b802e[_0x3b846(0x11a)][_0x3b846(0x149)] + '次'), !![]) : (log('广告福利领取失败：' + _0x2b802e[_0x3b846(0x14c)]), ![]); } catch (_0x3f51ad) { return log('广告任务执行异常：' + _0x3f51ad[_0x3b846(0x14c)]), ![]; } } async function runSingleAccount(_0x58a70d) { const _0x1d3e08 = _0x266875, [_0x2f7f0e, _0x30a6ff] = _0x58a70d[_0x1d3e08(0x109)]('#'); if (!_0x2f7f0e || !_0x30a6ff) { log(_0x1d3e08(0x121)); return; } const _0x4275a4 = parsePlatformFromUA(_0x30a6ff), _0x11f477 = parseVersionFromUA(_0x30a6ff), _0x1915f4 = await getMemberInfo(_0x2f7f0e, _0x30a6ff, _0x4275a4, _0x11f477); if (VERIFY_INVITE_ID) { if (!_0x1915f4[_0x1d3e08(0x12f)]) return; log(_0x1d3e08(0x152) + _0x1915f4[_0x1d3e08(0x16d)] + _0x1d3e08(0xfd)); } else log(_0x1d3e08(0x152) + _0x1915f4[_0x1d3e08(0x16d)] + _0x1d3e08(0xfd)); let _0x428785 = 0x0; while (!![]) { const _0x5984d1 = await getMemberCenterInfo(_0x2f7f0e, _0x30a6ff, _0x4275a4, _0x11f477); if (!_0x5984d1) break; if (!_0x5984d1[_0x1d3e08(0x14a)]) { log(_0x1d3e08(0xdc), ![]); break; } if (_0x5984d1['remaining'] <= 0x0) { log(_0x1d3e08(0xf7)); break; } const _0x45b8e5 = await checkMiniAppBound(_0x2f7f0e, _0x30a6ff, _0x4275a4, _0x11f477), _0x465690 = await getInternalAdVideoId(_0x2f7f0e, _0x30a6ff, _0x4275a4, _0x11f477); if (!_0x465690) { log(_0x1d3e08(0x172)), await wait(0x5); continue; } const _0x1d8ef1 = await watchAdAndReceiveWelfare(_0x2f7f0e, _0x30a6ff, _0x4275a4, _0x465690, _0x11f477, _0x5984d1[_0x1d3e08(0x14a)]); if (!_0x1d8ef1) { _0x428785++, log(_0x1d3e08(0xfa) + _0x428785 + _0x1d3e08(0x183)); if (_0x428785 > TASK_CONFIG[_0x1d3e08(0x161)]) { log(_0x1d3e08(0x153) + _0x428785 + _0x1d3e08(0xd8) + TASK_CONFIG[_0x1d3e08(0x161)] + _0x1d3e08(0x180), ![]); break; } await wait(0x5); continue; } _0x428785 = 0x0, await wait(TASK_CONFIG['PROFIT_WAIT_SEC']), await wait(0x2); } log(_0x1d3e08(0x16c)); } async function main() { const _0x5f09ff = _0x266875; log('=======\x20店铛铛新人解锁广告任务脚本启动\x20======='), log(_0x5f09ff(0x122)); const _0x162102 = process[_0x5f09ff(0x15b)][_0x5f09ff(0x17e)]; if (!_0x162102 || !_0x162102['trim']()) { log(_0x5f09ff(0xff), ![]), log(_0x5f09ff(0x134), ![]), log('变量名：DDD_ACCOUNTS', ![]), log(_0x5f09ff(0x15c), ![]), log(_0x5f09ff(0x139), ![]); return; } let _0x2aebd6 = [], _0x1239b6 = null, _0x2603ae = ![]; QL_CONFIG[_0x5f09ff(0x120)] && QL_CONFIG['CLIENT_SECRET'] ? (log(_0x5f09ff(0xf4)), _0x1239b6 = await getQingLongToken()) : log(_0x5f09ff(0x117)); const _0x1be33b = _0x162102[_0x5f09ff(0x109)]('\x0a')[_0x5f09ff(0x167)](_0xc006af => _0xc006af[_0x5f09ff(0x171)]()); log(_0x5f09ff(0x10b) + _0x1be33b['length'] + _0x5f09ff(0x185)); let _0x2db5bd = []; if (_0x1239b6) { const _0xca8962 = await getEnvFromQingLong(_0x1239b6, QL_CONFIG[_0x5f09ff(0x156)]); if (_0xca8962 && _0xca8962[_0x5f09ff(0x17a)]) { log('发现青龙面板缓存的token，尝试验证有效性...'); const _0x221ae4 = _0xca8962[_0x5f09ff(0x17a)][_0x5f09ff(0x109)]('\x0a')[_0x5f09ff(0x167)](_0x368830 => _0x368830[_0x5f09ff(0x171)]()); for (let _0x39e142 = 0x0; _0x39e142 < Math[_0x5f09ff(0x12d)](_0x1be33b[_0x5f09ff(0xe7)], _0x221ae4[_0x5f09ff(0xe7)]); _0x39e142++) { const [_0x3cb621, _0x5e6c31] = _0x221ae4[_0x39e142][_0x5f09ff(0x109)]('#'); if (_0x3cb621 && _0x5e6c31) { const _0x33a3e3 = parsePlatformFromUA(_0x5e6c31), _0x2326ce = parseVersionFromUA(_0x5e6c31), _0x57c82c = await isTokenValid(_0x3cb621, _0x5e6c31, _0x33a3e3, _0x2326ce); _0x57c82c ? (log('第' + (_0x39e142 + 0x1) + _0x5f09ff(0xe0)), _0x2db5bd['push'](_0x221ae4[_0x39e142])) : (log('第' + (_0x39e142 + 0x1) + _0x5f09ff(0xe9), ![]), _0x2db5bd['push'](null), _0x2603ae = !![]); } else _0x2db5bd[_0x5f09ff(0x15d)](null); } } } for (let _0x5cba45 = 0x0; _0x5cba45 < _0x1be33b['length']; _0x5cba45++) { const _0x216bcc = _0x1be33b[_0x5cba45][_0x5f09ff(0x171)](); if (_0x2db5bd[_0x5cba45]) continue; let _0x45f3e0, _0x4f29ef; if (_0x216bcc[_0x5f09ff(0xe2)]('&')) [_0x45f3e0, _0x4f29ef] = _0x216bcc[_0x5f09ff(0x109)]('&'); else { if (_0x216bcc['includes']('@')) [_0x45f3e0, _0x4f29ef] = _0x216bcc['split']('@'); else { log('第' + (_0x5cba45 + 0x1) + '个账号格式错误，需要\x20手机号&密码\x20格式', ![]); continue; } } _0x45f3e0 = _0x45f3e0[_0x5f09ff(0x171)](), _0x4f29ef = _0x4f29ef['trim'](), log(_0x5f09ff(0x168) + (_0x5cba45 + 0x1) + _0x5f09ff(0xf9) + _0x45f3e0); const _0x3a4a33 = await loginWithPassword(_0x45f3e0, _0x4f29ef); if (_0x3a4a33) { const _0x1321b0 = _0x3a4a33[_0x5f09ff(0x100)] + '#' + _0x3a4a33['ua']; _0x2db5bd[_0x5cba45] = _0x1321b0, _0x2603ae = !![]; } else log('第' + (_0x5cba45 + 0x1) + _0x5f09ff(0x136), ![]); _0x5cba45 < _0x1be33b[_0x5f09ff(0xe7)] - 0x1 && await wait(0x2); } _0x2aebd6 = _0x2db5bd['filter'](_0x2f28ca => _0x2f28ca), log(_0x5f09ff(0xd7) + _0x2aebd6[_0x5f09ff(0xe7)] + '\x20个有效token'), log(_0x5f09ff(0x170) + (_0x1239b6 ? '有' : '无') + _0x5f09ff(0x104) + _0x2603ae + _0x5f09ff(0x128) + _0x2aebd6[_0x5f09ff(0xe7)]); if (_0x1239b6 && _0x2603ae && _0x2aebd6[_0x5f09ff(0xe7)] > 0x0) { const _0x52f99a = _0x2aebd6[_0x5f09ff(0x101)]('\x0a'); log(_0x5f09ff(0x14e) + _0x2aebd6[_0x5f09ff(0xe7)] + _0x5f09ff(0xed)), _0x2aebd6[_0x5f09ff(0x13a)]((_0x1999c4, _0x1ff1c8) => { const _0x4a8206 = _0x5f09ff, _0x191118 = _0x1999c4[_0x4a8206(0x112)](0x0, 0x1e) + _0x4a8206(0xe3); log(_0x4a8206(0x17f) + (_0x1ff1c8 + 0x1) + ':\x20' + _0x191118); }); const _0x8ed1e3 = await getEnvFromQingLong(_0x1239b6, QL_CONFIG['ENV_NAME']), _0x1375d7 = _0x8ed1e3 ? _0x8ed1e3['id'] : null; log(_0x5f09ff(0x113) + (_0x8ed1e3 ? _0x5f09ff(0x15f) + _0x1375d7 + ')' : _0x5f09ff(0x135))), log('正在' + (_0x1375d7 ? '更新' : '创建') + '青龙环境变量\x20' + QL_CONFIG[_0x5f09ff(0x156)] + _0x5f09ff(0xe3)); const _0x3d5278 = await updateEnvToQingLong(_0x1239b6, QL_CONFIG[_0x5f09ff(0x156)], _0x52f99a, _0x1375d7); _0x3d5278 ? log(_0x5f09ff(0x10f)) : log('❌\x20Token同步到青龙面板失败，请检查日志', ![]); } else { if (!_0x1239b6) log(_0x5f09ff(0xfc)); else { if (!_0x2603ae) log(_0x5f09ff(0x102)); else _0x2aebd6[_0x5f09ff(0xe7)] === 0x0 && log('⚠️\x20没有可用的账号，跳过同步'); } } if (_0x2aebd6[_0x5f09ff(0xe7)] === 0x0) { log(_0x5f09ff(0x13e), ![]); return; } for (let _0x4964b0 = 0x0; _0x4964b0 < _0x2aebd6['length']; _0x4964b0++) { await runSingleAccount(_0x2aebd6[_0x4964b0]); if (_0x4964b0 < _0x2aebd6[_0x5f09ff(0xe7)] - 0x1) { const _0x4ace9f = getRandomWaitSeconds(); log(_0x5f09ff(0x114) + _0x4ace9f + _0x5f09ff(0xec)), await wait(_0x4ace9f); } } log(_0x5f09ff(0x145)); } main()['catch'](_0x2a3d49 => log(_0x266875(0x10e) + _0x2a3d49['message']));
