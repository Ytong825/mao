"""
ğŸ“– å°é˜…é˜…_V5.5   â™»20250813   

âœ… æ–°å¢ï¼šæ”¯æŒå¤šæ¸ é“æ¨é€ï¼Œè¯·åœ¨é’é¾™é…ç½®æ–‡ä»¶ config.sh ä¸­æ·»åŠ å¿…è¦çš„æ¨é€å‚æ•°ï¼Œå¹¶å°†å˜é‡ä¸­çš„tokenå‚æ•°è®¾ç½®ä¸º000(è¯¦è§ä¸‹æ–¹å‚æ•°è¯´æ˜)ã€‚(å»ºè®®ä½¿ç”¨è„šæœ¬è‡ªå¸¦pushplusæ¨é€ï¼Œæ›´ç¨³å®š)ã€‚
âœ… å®Œå–„æ£€æµ‹æ–‡ç« ã€‚
âœ… ä¿®æ”¹bugï¼Œå®Œå–„å¤šæ¸ é“æ¨é€ã€‚

ğŸ”” é˜…è¯»èµšé‡‘å¸ï¼Œé‡‘å¸å¯æç°ï¼Œæ¯å¤©1â€”2å…ƒï¼Œæœ¬è„šæœ¬è‡ªåŠ¨æ¨é€æ£€æµ‹æ–‡ç« åˆ°å¾®ä¿¡ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨é˜…è¯»è¿‡æ£€æµ‹ï¼Œè¿‡æ£€æµ‹åè„šæœ¬è‡ªåŠ¨å®Œæˆå‰©ä½™ä»»åŠ¡ï¼Œä¸éœ€è¦ä¸‹è½½appï¼Œåœ¨å¾®ä¿¡æ‰“å¼€ä¸‹æ–¹é“¾æ¥å³å¯è¿›å…¥åˆ°æ´»åŠ¨é¡µã€‚(æ‰“å¼€æ´»åŠ¨é¡µæ—¶è¯·æ— è§†å¾®ä¿¡çš„å®‰å…¨æç¤º)

ğŸ‘‰æ´»åŠ¨å…¥å£ å¾®ä¿¡æ‰“å¼€ï¼šhttp://2121430.k4f1.sanming0.cn/yyiyase/f56fb7c54f55edd1b77d23b3577da92b?ukd=88     
å¤‡ç”¨é“¾æ¥ï¼šhttps://tinyurl.com/5t3yhsfm     
          https://tinyurl.com/2tc96zpc    
æœ€æ–°åœ°å€è·å–ï¼šhttps://tinyurl.com/27y64eve

ğŸ‘‰å»ºè®®å°†é“¾æ¥æ·»åŠ è‡³å¾®ä¿¡æ”¶è—(å¾®ä¿¡_æˆ‘_æ”¶è—_âŠ•_ç²˜è´´)ï¼Œå¹¶æ·»åŠ å¤‡æ³¨ä»¥æ–¹ä¾¿æŸ¥æ‰¾ã€‚
"""

import os, requests, time, json, random

# ========== é…ç½®åŒºåŸŸ ==========
# ä»ç¯å¢ƒå˜é‡è¯»å–è´¦å·ä¿¡æ¯
accounts = os.environ.get("xyy_ck", "").split("&")

# æ¨é€ç›¸å…³é…ç½®
PUSHPLUS_TOKEN = os.environ.get("PUSHPLUS_TOKEN", "")
BARK_TOKEN     = os.environ.get("BARK_TOKEN", "")
TG_BOT_TOKEN   = os.environ.get("TG_BOT_TOKEN", "")
TG_USER_ID     = os.environ.get("TG_USER_ID", "")
QYWX_KEY       = os.environ.get("QYWX_KEY", "")

# ==============================

headers = {
    "User-Agent": "Mozilla/5.0 (Linux; Android 10; Mobile Safari/537.36)"
}

def log(msg):
    print(f"[å°é˜…é˜…] {msg}")

# ========== æ¨é€å‡½æ•° ==========
def pushplus(title, content):
    if not PUSHPLUS_TOKEN or PUSHPLUS_TOKEN == "000":
        return
    url = "http://www.pushplus.plus/send"
    data = {
        "token": PUSHPLUS_TOKEN,
        "title": title,
        "content": content
    }
    try:
        requests.post(url, json=data, timeout=10)
    except:
        pass

def bark(title, content):
    if not BARK_TOKEN: return
    url = f"https://api.day.app/{BARK_TOKEN}/{title}/{content}"
    try:
        requests.get(url, timeout=10)
    except:
        pass

def tg_bot(title, content):
    if not TG_BOT_TOKEN or not TG_USER_ID: return
    url = f"https://api.telegram.org/bot{TG_BOT_TOKEN}/sendMessage"
    data = {"chat_id": TG_USER_ID, "text": f"{title}\n\n{content}"}
    try:
        requests.post(url, data=data, timeout=10)
    except:
        pass

def qywx(title, content):
    if not QYWX_KEY: return
    url = f"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key={QYWX_KEY}"
    data = {
        "msgtype": "text",
        "text": {"content": f"{title}\n\n{content}"}
    }
    try:
        requests.post(url, json=data, timeout=10)
    except:
        pass

def notify(title, content):
    log(content)
    pushplus(title, content)
    bark(title, content)
    tg_bot(title, content)
    qywx(title, content)


# ========== ä»»åŠ¡æ ¸å¿ƒé€»è¾‘ ==========

def check_in(session, ck):
    """æ£€æµ‹æ–‡ç« æ˜¯å¦èƒ½æ‰“å¼€"""
    url = "https://sanming0.cn/api/check"
    try:
        r = session.get(url, headers=headers, timeout=10)
        if "æ£€æµ‹æˆåŠŸ" in r.text:
            return True
    except:
        return False
    return False

def read_article(session, ck):
    """æ¨¡æ‹Ÿé˜…è¯»æ–‡ç« ï¼Œè·å¾—é‡‘å¸"""
    url = "https://sanming0.cn/api/read"
    try:
        r = session.get(url, headers=headers, timeout=10)
        data = r.json()
        if data.get("code") == 0:
            return data.get("msg", "æˆåŠŸ")
        else:
            return data.get("msg", "å¤±è´¥")
    except Exception as e:
        return f"å¼‚å¸¸: {e}"

def get_info(session, ck):
    """æŸ¥è¯¢è´¦æˆ·é‡‘å¸ä¿¡æ¯"""
    url = "https://sanming0.cn/api/userinfo"
    try:
        r = session.get(url, headers=headers, timeout=10)
        data = r.json()
        coin = data.get("coin", 0)
        cash = coin / 10000
        return f"é‡‘å¸ï¼š{coin}ï¼ˆâ‰ˆ{cash:.2f}å…ƒï¼‰"
    except:
        return "è·å–è´¦æˆ·ä¿¡æ¯å¤±è´¥"

def run_task(ck):
    """æ‰§è¡Œå•ä¸ªè´¦å·ä»»åŠ¡"""
    session = requests.Session()
    session.headers.update(headers)
    session.headers.update({"Cookie": ck})

    result = []
    log("å¼€å§‹æ£€æµ‹æ–‡ç« ...")
    if not check_in(session, ck):
        result.append("âŒ æ£€æµ‹æ–‡ç« å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é˜…è¯»ä¸€æ¬¡æ£€æµ‹æ–‡ç« ")
        return "\n".join(result)

    log("æ£€æµ‹æ–‡ç« æˆåŠŸï¼Œå¼€å§‹é˜…è¯»...")
    for i in range(10):
        msg = read_article(session, ck)
        result.append(f"ç¬¬{i+1}æ¬¡é˜…è¯»: {msg}")
        time.sleep(random.randint(3, 8))  # æ¨¡æ‹Ÿäººå·¥é—´éš”

    result.append(get_info(session, ck))
    return "\n".join(result)


# ========== ä¸»å…¥å£ ==========

def main():
    if not accounts or accounts == [""]:
        log("æœªæ£€æµ‹åˆ°è´¦å·å˜é‡ï¼Œè¯·åœ¨é’é¾™ config.sh ä¸­æ·»åŠ  xyy_ck")
        return

    all_msg = []
    for i, ck in enumerate(accounts, 1):
        log(f"å¼€å§‹æ‰§è¡Œè´¦å·{i}")
        msg = run_task(ck)
        account_msg = f"è´¦å·{i} æ‰§è¡Œç»“æœï¼š\n{msg}\n"
        all_msg.append(account_msg)

    final_msg = "\n".join(all_msg)
    notify("å°é˜…é˜…ä»»åŠ¡ç»“æœ", final_msg)


if __name__ == "__main__":
    main()
